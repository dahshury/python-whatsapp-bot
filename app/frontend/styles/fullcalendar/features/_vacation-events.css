/**
 * VACATION SYSTEM - COMPLETE FEATURE MODULE
 * ==========================================
 *
 * Responsibility: All vacation-related styling across ALL calendar views
 * - Vacation background events (semi-transparent overlays)
 * - Vacation day styling (disabled/blocked days)
 * - Vacation day hover states and interactions
 * - Dark mode vacation styling
 * - Cross-view compatibility (daygrid, timegrid, multimonth, list)
 *
 * Dependencies: CSS variables from theme files (--vacation-bg, --vacation-bg-opacity)
 * Used by: All calendar views when vacation periods are active
 */

/* =================================================================
   VACATION BACKGROUND EVENTS
   ================================================================= */

/**
 * Semi-transparent background overlays for vacation periods
 * Applied as background events that span the vacation duration
 */
.fc-bg-event.vacation-background-event,
.vacation-background-event {
	background-color: hsl(var(--vacation-bg) / var(--vacation-bg-opacity));
	border: none;
	pointer-events: none;
	/* Ensure vacation overlays sit above base day backgrounds */
	z-index: var(--z-calendar-day-bg-highlight);
}

/**
 * Regular events styled as vacation period overlays
 * More stable than background events, won't get cleared by refetchEvents
 */
.fc-event.vacation-period-event {
	background-color: hsl(var(--vacation-bg) / var(--vacation-bg-opacity)) !important;
	border-color: hsl(var(--vacation-bg) / 0.3) !important;
	color: transparent !important;
	pointer-events: none;
	opacity: 0.8;
	z-index: 1; /* Above day cells but below regular events */
}

.fc-event.vacation-period-event .fc-event-title,
.fc-event.vacation-period-event .fc-event-time {
	display: none; /* Hide all text content */
}

/* Cross-view compatibility for vacation background events */
.fc-daygrid .fc-bg-event.vacation-background-event,
.fc-timegrid .fc-bg-event.vacation-background-event,
.fc-multimonth .fc-bg-event.vacation-background-event,
.fc-list .fc-bg-event.vacation-background-event {
	background-color: hsl(var(--vacation-bg) / var(--vacation-bg-opacity));
}

/* =================================================================
   VACATION BACKGROUND EVENT HEIGHT CONSTRAINTS
   ================================================================= */

/**
 * Critical height fixes for month and multimonth views
 * Prevents vacation events from extending beyond day cell boundaries
 */
.fc-daygrid .fc-bg-event.vacation-background-event,
.fc-multimonth .fc-bg-event.vacation-background-event {
	/* Critical height constraints */
	height: 100%;
	max-height: none; /* Remove height limit that might affect color rendering */
	min-height: 0;
	overflow: hidden;

	/* Critical positioning */
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;

	/* Remove any margins/padding that could cause overflow */
	margin: 0;
	padding: 0;

	/* Ensure contained within parent */
	box-sizing: border-box;
}

/* Specific constraints for vacation events within day cells */
.fc-daygrid-day .fc-bg-event.vacation-background-event,
.fc-multimonth .fc-daygrid-day .fc-bg-event.vacation-background-event {
	/* Force absolute positioning within the day cell */
	position: absolute;
	inset: 0; /* Modern shorthand for top:0, right:0, bottom:0, left:0 */

	/* Critical: prevent any dimension overflow */
	width: 100%;
	height: 100%;
	max-width: 100%;
	max-height: none; /* Remove height limit that might affect color rendering */
	min-width: 0;
	min-height: 0;

	/* Prevent content overflow */
	overflow: hidden;

	/* Remove any transforms or scaling that might cause issues */
	transform: none;

	/* Ensure proper stacking above base day backgrounds */
	z-index: var(--z-calendar-day-bg-highlight);
}

/* Multimonth specific height enforcement */
.fc-multimonth .fc-daygrid-day {
	position: relative; /* Ensure positioning context for absolute children */
}

.fc-multimonth .fc-daygrid-day .fc-bg-event.vacation-background-event {
	/* Ensure consistent rendering in multimonth view */
	max-height: none;
	height: 100%;

	/* Remove clip-path that might affect color rendering */
	clip-path: none;

	/* Ensure consistent color rendering */
	background-color: hsl(var(--vacation-bg) / var(--vacation-bg-opacity));
	opacity: 1;
}

/* =================================================================
   VACATION DAYS - DISABLED DAY STYLING
   ================================================================= */

/**
 * Vacation days are disabled days that users cannot interact with
 * They have distinct styling to indicate they're unavailable
 */

/* Universal vacation day styling - base appearance */
.fc-day.vacation-day {
	background-color: hsl(var(--destructive) / 0.15);
	cursor: not-allowed;
	position: relative;
}

.dark .fc-day.vacation-day {
	background-color: hsl(var(--destructive) / 0.2);
}

/* Vacation day hover prevention */
.fc-day.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.15);
	box-shadow: none;
	cursor: not-allowed;
	transition: none;
}
/* Disable day header nav link clicks on vacation days */
.fc-col-header-cell.vacation-day-header a,
.fc-timegrid-axis-frame.vacation-day-header a {
	pointer-events: none;
	cursor: default;
}

.dark .fc-day.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.2);
}

.dark .fc-daygrid-day.vacation-day::before,
.dark .fc-timegrid-col.vacation-day::before {
	background-color: hsl(var(--destructive) / 0.25);
}

/* Prevent selection highlight on vacation days */
.fc-daygrid-day.vacation-day .fc-highlight,
.vacation-day .fc-highlight {
	display: none;
	background: none;
	opacity: 0;
}

/* Ensure vacation day events are visible above the overlay */
.fc-daygrid-day.vacation-day .fc-daygrid-day-events {
	z-index: var(--z-calendar-events);
}

/* =================================================================
   VACATION DAY FRAME STYLING (View-Specific)
   ================================================================= */

/**
 * Vacation day frame styling for different views
 * Provides consistent appearance across daygrid and multimonth views
 */

/* Make vacation day number (nav link) non-interactive, but allow event clicks */
.fc-multimonth .fc-daygrid-day.vacation-day a.fc-daygrid-day-number,
.fc-daygrid .fc-daygrid-day.vacation-day a.fc-daygrid-day-number {
	pointer-events: none;
}

/* Vacation day events remain clickable (for opening conversations) */
.fc-multimonth .fc-daygrid-day.vacation-day .fc-event,
.fc-daygrid .fc-daygrid-day.vacation-day .fc-event {
	opacity: 0.7;
	position: relative;
	z-index: var(--z-fc-multimonth-variant-primary);
}

/* =================================================================
   DAY VIEW VACATION STYLING
   ================================================================= */

/**
 * Specific vacation styling for day view
 * Handles the unique layout and interaction patterns of day view
 */

/* Disable vacation day hover effects in day view */
.fc-timeGridDay-view .fc-day.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.15);
	box-shadow: none;
	cursor: not-allowed;
	transition: none;
	transform: none;
	filter: none;
	opacity: inherit;
}

/* Dark mode vacation day hover overrides for day view */
.dark .fc-timeGridDay-view .fc-day.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.2);
	box-shadow: none;
	cursor: not-allowed;
	transition: none;
	transform: none;
	filter: none;
	opacity: inherit;
}

/* =================================================================
   WEEK VIEW VACATION STYLING (timeGridWeek)
   ================================================================= */

/* Show not-allowed cursor in vacation columns in week view (keep event clicks working) */
.fc-timeGridWeek-view .fc-timegrid-col.vacation-day {
	cursor: not-allowed;
}

/* Disable hover effects for vacation columns in week view */
.fc-timeGridWeek-view .fc-timegrid-col.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.15);
	box-shadow: none;
	transition: none;
	transform: none;
	filter: none;
}

.dark .fc-timeGridWeek-view .fc-timegrid-col.vacation-day:hover {
	background-color: hsl(var(--destructive) / 0.2);
}

/* Hide selection highlight within vacation columns in week view */
.fc-timeGridWeek-view .fc-timegrid-col.vacation-day .fc-highlight {
	display: none;
	opacity: 0;
}

/* =================================================================
   DARK MODE VACATION STYLING
   ================================================================= */

/**
 * Enhanced dark mode styling for vacation elements
 * Provides better visibility and contrast in dark themes
 */

/* Dark mode vacation styling for better visibility */
.dark .fc-multimonth
	.fc-daygrid-day.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame,
.dark
	.fc-daygrid
	.fc-daygrid-day.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	opacity: 0.9;
}

/* =================================================================
   HIGH CONTRAST MODE SUPPORT
   ================================================================= */

/**
 * Accessibility: High-contrast mode support for vacation elements
 * Increases opacity and adds borders for better visibility
 */
@media (prefers-contrast: high) {
	.fc-bg-event.vacation-background-event,
	.vacation-background-event {
		background-color: hsl(var(--vacation-bg) / 0.25);
		border: 1px solid hsl(var(--vacation-bg) / 0.5);
	}
}

/* =================================================================
   FREE ROAM MODE VACATION EXCLUSIONS
   ================================================================= */

/**
 * Free roam mode specific behavior for vacation days
 * Maintains vacation restrictions even in free roam mode
 */

/* Remove custom coloring for past/disabled days in free roam, but keep vacation styling */
[data-free-roam="true"] .fc-day-disabled:not(.vacation-day),
[data-free-roam="true"] .fc-day-past:not(.vacation-day) {
	background-color: transparent;
	opacity: 1;
}

/* =================================================================
   HIGH-SPECIFICITY VACATION TODAY OVERRIDES
   ================================================================= */

/**
 * Override today's styling when it falls on a vacation day
 * Uses same specificity patterns as today styling to ensure proper override
 */

/* Frame styling override - matches today frame specificity */
.fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
.fc-daygrid-day-frame {
	background: hsl(var(--destructive) / 0.2);
	background-image: none;
}

/* Multimonth frame styling override - highest specificity */
.fc-multimonth .fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background: hsl(var(--destructive) / 0.2);
	background-image: none;
}

/* Dark mode overrides */
.dark .fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background: hsl(var(--destructive) / 0.3);
	background-image: none;
}

.dark
	.fc-multimonth
	.fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background: hsl(var(--destructive) / 0.3);
	background-image: none;
}

/* =================================================================
   VACATION PATTERN BACKGROUND
   ================================================================= */

/* Define reusable zigzag pattern (light and dark variants) */
:root {
	--vacation-pattern: repeating-linear-gradient(
			0deg,
			transparent,
			transparent 15px,
			rgba(75, 85, 99, 0.15) 15px,
			rgba(75, 85, 99, 0.15) 16px
		),
		repeating-linear-gradient(
			90deg,
			transparent,
			transparent 25px,
			rgba(107, 114, 128, 0.12) 25px,
			rgba(107, 114, 128, 0.12) 26px
		),
		repeating-linear-gradient(
			60deg,
			transparent,
			transparent 30px,
			rgba(55, 65, 81, 0.10) 30px,
			rgba(55, 65, 81, 0.10) 31px
		),
		repeating-linear-gradient(
			150deg,
			transparent,
			transparent 28px,
			rgba(31, 41, 55, 0.08) 28px,
			rgba(31, 41, 55, 0.08) 29px
		);
}

.dark {
	--vacation-pattern: repeating-linear-gradient(
			0deg,
			transparent,
			transparent 15px,
			rgba(255, 255, 255, 0.20) 15px,
			rgba(255, 255, 255, 0.20) 16px
		),
		repeating-linear-gradient(
			90deg,
			transparent,
			transparent 25px,
			rgba(255, 255, 255, 0.18) 25px,
			rgba(255, 255, 255, 0.18) 26px
		),
		repeating-linear-gradient(
			60deg,
			transparent,
			transparent 30px,
			rgba(255, 255, 255, 0.15) 30px,
			rgba(255, 255, 255, 0.15) 31px
		),
		repeating-linear-gradient(
			150deg,
			transparent,
			transparent 28px,
			rgba(255, 255, 255, 0.12) 28px,
			rgba(255, 255, 255, 0.12) 29px
		);
}

/* Apply pattern to vacation day cells */
.fc-day.vacation-day {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

.fc-day.vacation-day:hover {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

/* Ensure full coverage in dayGrid and multiMonth cells by styling the frame */
.fc-daygrid-day.vacation-day .fc-daygrid-day-frame,
.fc-multimonth .fc-daygrid-day.vacation-day .fc-daygrid-day-frame {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

/* Apply pattern to background events used for vacation spans */
.fc-bg-event.vacation-background-event,
.vacation-background-event {
	background-image: var(--vacation-pattern);
	background-color: transparent !important;
	border-color: transparent !important;
}

.fc-daygrid .fc-bg-event.vacation-background-event,
.fc-timegrid .fc-bg-event.vacation-background-event,
.fc-multimonth .fc-bg-event.vacation-background-event,
.fc-list .fc-bg-event.vacation-background-event {
	background-image: var(--vacation-pattern);
	background-color: transparent !important;
}

.fc-multimonth .fc-daygrid-day .fc-bg-event.vacation-background-event {
	background-image: var(--vacation-pattern);
	background-color: transparent !important;
	opacity: 1;
}

/* Ensure 'today' on vacation also shows the pattern */
.fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
.fc-daygrid-day-frame {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

.fc-multimonth .fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

.dark .fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

.dark
	.fc-multimonth
	.fc-daygrid-day.fc-day-today.vacation-day:not(.fc-day-past)
	.fc-daygrid-day-frame {
	background-image: var(--vacation-pattern);
	background-color: transparent;
}

/* =================================================================
   VACATION TEXT EVENTS - CENTERED LABEL OVERLAY
   ================================================================= */

/* Make the text overlay fill the entire day cell and be non-interactive */
.fc-event.vacation-text-event {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: var(--z-calendar-day-bg-highlight);
	pointer-events: none;
	background: transparent !important;
	border: none !important;
	padding: 0 !important;
	margin: 0 !important;
	display: flex;
	align-items: center;
	justify-content: center;
	color: hsl(var(--foreground));
}

/* Ensure positioning context exists in multimonth and daygrid cells */
.fc-multimonth .fc-daygrid-day,
.fc-daygrid .fc-daygrid-day {
	position: relative;
}

/* Hide default sub-elements to avoid top-left titles */
.fc-event.vacation-text-event .fc-event-title,
.fc-event.vacation-text-event .fc-event-time,
.fc-event.vacation-text-event .fc-event-time-start,
.fc-event.vacation-text-event .fc-event-time-sep,
.fc-event.vacation-text-event .fc-event-time-end,
.fc-event.vacation-text-event .fc-event-title-container {
	display: none !important;
}

/* Typography for overlay text */
.fc-event.vacation-text-event .fc-event-main,
.fc-event.vacation-text-event .fc-event-main-frame {
	font-weight: 800;
	font-size: 18px;
	letter-spacing: 0.3px;
	text-align: center;
}

.dark .fc-event.vacation-text-event {
	color: hsl(var(--foreground));
}
