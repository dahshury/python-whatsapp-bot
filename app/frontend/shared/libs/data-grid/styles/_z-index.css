/**
 * Global Z-Index CSS Variables - Centralized Layering System
 *
 * This file defines the centralized z-index scale with proper hierarchy:
 * 1. Calendar (base layer): 0-100
 * 2. Dialog backdrop: 1000
 * 3. Dialog content: 2000
 * 4. Data cell editors & widgets: 3000
 * 5. Fullscreen mode: 8000
 * 6. Discard changes dialog: 9000
 */

:root {
  /* ========================================
   * LAYER 1: CALENDAR & BASE UI (0-100)
   * ======================================== */
  --z-background: 0;
  --z-base: 1;
  --z-sticky-header: 10;
  --z-focus-ring: 10;
  --z-sidebar-resizer: 20;
  --z-navigation: 10;
  --z-navigation-indicator: 1;
  --z-document-overlay: 1800;
  --z-document-controls: 1900;
  --z-chat-footer: 100;
  --z-toast: 100;
  --z-calendar-day-bg-non-business: 1;
  --z-calendar-day-bg-event: 2;
  --z-calendar-vacation-bg: 3;
  --z-calendar-day-bg-highlight: 4;
  --z-calendar-day-number: 5;
  --z-calendar-week-number: 6;
  --z-calendar-event: 7;
  --z-calendar-event-mirror: 8;
  --z-calendar-vacation-event: 1;
  --z-calendar-events: 20;
  --z-hover-effects: 30;
  --z-scroll-button: 50;
  --z-highlight-background: 0;
  --z-highlight-content: 1;
  --z-sidebar: 400;
  --z-dropdown: 200;
  --z-hover-card: 270;
  --z-tooltip: 100;
  --z-popover: 450;
  --z-context-menu: 250;
  --z-sidebar-chat-overlay: 410;
  --z-sidebar-chat-tooltip: 415;

  /* ========================================
   * POPOVER & DROPDOWN SYSTEM (100-500)
   * ======================================== */
  --z-filter-menu: 500;
  --z-submenu: 550;
  --z-submenu-nested: 600;
  --z-combobox-dropdown: 450;
  --z-select: 450;

  /* ========================================
   * ANIMATED & INTERACTIVE ELEMENTS (40-100)
   * ======================================== */
  --z-animated-trigger: 40;
  --z-event-count-badge: 45;
  --z-fc-scrollgrid: 3;
  --z-fc-sticky: 3;
  --z-fc-button: 1;
  --z-fc-multimonth-header: 1;
  --z-fc-multimonth-container: 1;
  --z-fc-multimonth-variant-primary: 2;
  --z-fc-multimonth-variant-secondary: 1;
  --z-fc-week: 1;
  --z-fc-day-cell-base: 4;
  --z-fc-day-cell-content: 1;
  --z-fc-free-roam: 10;
  --z-calendar-dragging: 85;
  --z-timegrid-more-link: 95;
  --z-fc-more-popover: 2500;

  /* ========================================
   * DIALOG SYSTEM (700-750)
   * ======================================== */
  --z-dialog-backdrop: 700;
  --z-dialog-content: 710;
  --z-dialog-overlays: 720;
  --z-dialog-overlay-portal: 720;
  --z-video-dialog-content: 750;

  /* ========================================
   * SPECIALIZED OVERLAYS (800-900)
   * ======================================== */
  --z-grid-overlay: 800;
  --z-grid-overlay-editor: 810;
  --z-grid-editor-max: 810;
  --z-date-picker: 820;
  --z-date-picker-widget: 830;
  --z-grid-dropdown: 840;
  --z-grid-tooltip: 680;
  --z-grid-menu: 970;
  --z-enhanced-column-menu: 975;
  --z-grid-component: 10;

  /* ========================================
   * THEME LAYERS
   * ======================================== */
  --z-theme-layer-0: 0;
  --z-theme-layer-1: 1;
  --z-theme-layer-2: 2;

  /* ========================================
   * CHAT LAYERS
   * ======================================== */
  --z-chat-background: 0;
  --z-chat-message: 1;
  --z-chat-content: 2;
  --z-behind: -1;

  /* ========================================
   * MODAL SYSTEM (500-600)
   * ======================================== */
  --z-modal-backdrop: 500;
  --z-modal-content: 510;
  --z-confirmation-backdrop: 520;
  --z-confirmation-content: 530;
  --z-sheet-backdrop: 500;
  --z-sheet-content: 510;
  --z-debug-overlay: 600;

  /* ========================================
   * DIALOG SYSTEM (700-750)
   * ======================================== */
  --z-dialog-backdrop: 700;
  --z-dialog-content: 710;
  --z-dialog-overlays: 720;
  --z-dialog-overlay-portal: 720;
  --z-video-dialog-content: 750;
  --z-animated-trigger-above-dialog: 730;
  --z-elements-below-dialog: 39;
  --z-dialog-content-plus-1: 711; /* For tooltips/hover cards above dialog content */
  --z-grid-menu-minus-1: 969; /* For context menu backgrounds */

  /* ========================================
   * SPECIALIZED OVERLAYS (800-900)
   * ======================================== */
  --z-grid-overlay: 800;
  --z-grid-overlay-editor: 810;
  --z-grid-editor-max: 810;
  --z-date-picker: 820;
  --z-date-picker-widget: 830;
  --z-grid-dropdown: 840;
  --z-grid-tooltip: 680;
  --z-grid-modal: 950;
  --z-command-overlay: 1300;

  /* ========================================
   * FULLSCREEN MODE (1100-1455)
   * ======================================== */
  --z-fullscreen-backdrop: 1100;
  --z-fullscreen-content: 1110;
  --z-grid-fullscreen-backdrop: 1100;
  --z-grid-fullscreen-content: 1110;
  --z-grid-fullscreen-overlay: 1450;
  --z-grid-fullscreen: 1455;

  /* ========================================
   * ELEVATED CONFIRMATIONS (950-1000)
   * ======================================== */
  --z-confirmation-overlay-backdrop: 950;
  --z-confirmation-overlay-content: 960;
  --z-grid-menu: 970;
  --z-enhanced-column-menu: 975;

  /* ========================================
   * CRITICAL SYSTEM OVERLAYS (1400-1500)
   * ======================================== */
  --z-enhanced-overlay: 1400;
  --z-backend-connection: 1400;
  --z-toaster: 1500;

  /* ========================================
   * EMERGENCY/DEBUG LAYERS (2000+)
   * ======================================== */
  --z-emergency-overlay: 2000;
  --z-debug-overlay-legacy: 50000;

  /* ========================================
   * GLIDE DATA GRID LAYERS (Base grid only)
   * ======================================== */
  --z-grid-base: 1;
  --z-grid-cell: 1;
  --z-grid-header: 10;
  --z-grid-header-active: 11;
  --z-grid-selection: 20;
  --z-grid-hover: 25;
  --z-grid-component: 10;
}

/* ========================================
 * CUSTOM DIALOG ANIMATIONS
 * ======================================== */

@keyframes dialog-appear {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

/* Disabled for framer-motion driven dialogs; set inline style animation: none */
/* .dialog-content {
    animation: dialog-appear 200ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
} */

/* ========================================
 * GLIDE DATA GRID SPECIFIC OVERRIDES
 * ======================================== */

/* Grid container and base elements */
.gdg-wmyidgi {
  z-index: var(--z-grid-base);
}

/* Grid overlay editors - critical priority */
.gdg-d19meir1,
.glide-data-grid-overlay-editor,
.click-outside-ignore {
  z-index: var(--z-grid-overlay-editor);
}

/* Grid editor maximum priority for critical operations */
.grid-editor-critical,
.gdg-d19meir1.gdg-style {
  z-index: var(--z-grid-editor-max);
}

/* Grid cell overlays */
.gdg-cell-overlay {
  z-index: var(--z-grid-overlay);
}

/* Grid menus and dropdowns */
.gdg-menu,
.gdg-dropdown {
  z-index: var(--z-grid-menu);
}

/* Grid tooltips */
.gdg-tooltip {
  z-index: var(--z-grid-tooltip);
}

/* Grid fullscreen mode */
.gdg-fullscreen-overlay {
  z-index: var(--z-grid-fullscreen-overlay);
}

/* ========================================
 * FULLCALENDAR SPECIFIC OVERRIDES
 * ======================================== */

/* Calendar internal layering */
.fc-daygrid-day-bg .fc-non-business {
  z-index: var(--z-calendar-day-bg-non-business);
}

.fc-daygrid-day-bg .fc-bg-event {
  z-index: var(--z-calendar-day-bg-event);
}

/* Vacation background events - higher than other bg events, lower than regular events */
.fc-bg-event.vacation-background-event,
.vacation-background-event {
  z-index: var(--z-calendar-vacation-bg);
}

.fc-daygrid-day-bg .fc-highlight {
  z-index: var(--z-calendar-day-bg-highlight);
}

.fc-daygrid-day-number {
  z-index: var(--z-calendar-day-number);
}

.fc-daygrid-week-number {
  z-index: var(--z-calendar-week-number);
}

.fc-daygrid-event,
.fc-timegrid-event {
  z-index: var(--z-calendar-event);
}

.fc-daygrid-event.fc-event-mirror {
  z-index: var(--z-calendar-event-mirror);
}

/* Calendar context menus and popovers */
.fc-popover,
[data-fc-popover],
.fc-more-popover {
  z-index: var(--z-fc-more-popover);
}

/* Calendar hover cards - force high z-index */
.fc-hover-card-container {
  z-index: var(--z-hover-card);
}

/* Force hover card portal to appear above all calendar elements */
.calendar-hover-card-portal,
[class*="hover-card"] {
  z-index: var(--z-hover-card);
}

/* Calendar dragging events */
.fc-event-dragging {
  z-index: var(--z-calendar-dragging);
}

/* Timegrid more links - DISABLED */
/*
.fc-timegrid-more-link {
  z-index: var(--z-timegrid-more-link);
}
*/

/* FullCalendar more links and popovers - multimonth specific - DISABLED */
/*
.fc-multimonth .fc-more-popover,
.fc-multimonth .fc-more-link,
.fc-more-link {
  z-index: var(--z-fc-more-popover);
}
*/

/* ========================================
 * GLOBAL UI COMPONENT OVERRIDES
 * ======================================== */

/* Date picker components */
.tempus-dominus-widget,
.dropdown-menu[data-popper-placement] {
  z-index: var(--z-date-picker);
}

/* Bootstrap date picker widget */
.bootstrap-datetimepicker-widget {
  z-index: var(--z-date-picker-widget);
}

/* Tooltips */
[role="tooltip"],
.tooltip {
  z-index: var(--z-tooltip);
}

/* Dropdowns */
[role="listbox"],
[role="menu"],
.dropdown-menu:not([data-popper-placement]) {
  z-index: var(--z-dropdown);
}

/* Popovers */
[data-radix-popper-content-wrapper],
.popover-content {
  z-index: var(--z-popover);
}

/* Sidebar */
.sidebar-nav {
  z-index: var(--z-sidebar);
}

/* Side chat components */
.sidebar-chat-overlay,
.chat-loading-overlay {
  z-index: var(--z-sidebar-chat-overlay);
}

.sidebar-chat-tooltip,
.chat-message-tooltip {
  z-index: var(--z-sidebar-chat-tooltip);
}

/* Modal components */
.modal-backdrop,
.portal-backdrop {
  z-index: var(--z-modal-backdrop);
}

.modal-content,
.portal-content {
  z-index: var(--z-modal-content);
}

/* Confirmation dialogs */
.unsaved-changes-backdrop,
.confirmation-backdrop {
  z-index: var(--z-confirmation-backdrop);
  position: fixed;
}

.unsaved-changes-content,
.confirmation-content {
  z-index: var(--z-confirmation-content);
  position: fixed;
}

/* Fullscreen overlays */
.fullscreen-backdrop {
  z-index: var(--z-fullscreen-backdrop);
}

.fullscreen-content {
  z-index: var(--z-fullscreen-content);
}

/* Debug overlays */
.debug-overlay {
  z-index: var(--z-debug-overlay);
}

/* ========================================
 * DIALOG COMPONENT OVERRIDES
 * ======================================== */

/* Custom dialog backdrop */
.dialog-backdrop {
  z-index: var(--z-dialog-backdrop);
}

/* Custom dialog content class */
.dialog-content {
  z-index: var(--z-dialog-content);
}

/* Override Radix UI dialog z-50 default */
[data-radix-dialog-content].z-50 {
  z-index: var(--z-dialog-content);
}

/* Override Radix UI overlay z-50 default */
[data-radix-dialog-overlay].z-50 {
  z-index: var(--z-dialog-backdrop);
}

/* All overlay elements that should appear above dialog */
.gdg-d19meir1,
.glide-data-grid-overlay-editor,
.click-outside-ignore,
select,
.column-menu,
.glide-column-menu,
[data-radix-popper-content-wrapper],
[data-radix-select-content],
[data-radix-dropdown-menu-content],
[data-radix-popover-content],
[data-radix-tooltip-content],
[data-radix-context-menu-content],
.tempus-dominus-widget,
.td-picker,
.td-overlay,
.td-widget,
.tempus-dominus,
.react-tel-input .country-list,
.dropdown-menu,
.select-dropdown,
.autocomplete-dropdown,
.combobox-dropdown {
  z-index: var(--z-dialog-overlays);
}

/* Enhanced column menu should use its own z-index (above grid menu) */
.enhanced-column-menu {
  z-index: var(--z-enhanced-column-menu);
}

/* Hover card content: default to hover-card layer, not dialog overlays */
[data-radix-hover-card-content] {
  z-index: var(--z-hover-card);
}

/* Force dialog backdrop to highest z-index */
.dialog-backdrop {
  position: fixed;
  inset: 0;
  z-index: var(--z-dialog-backdrop);
}

/* Force all potentially conflicting elements to lower z-index */
.animated-sidebar-trigger {
  z-index: var(--z-animated-trigger-above-dialog); /* Above sticky header/backdrop */
  pointer-events: auto;
}

.calendar-legend-trigger {
  z-index: var(--z-animated-trigger-above-dialog); /* Above sticky header/backdrop */
  pointer-events: auto;
}

[data-radix-hover-card-content] {
  z-index: var(--z-hover-card);
}

/* Nuclear option: When dialog backdrop exists anywhere, force specific elements below it */
html:has(.dialog-backdrop) .animated-sidebar-trigger,
html:has(.dialog-backdrop) .calendar-legend-trigger,
html:has(.dialog-backdrop) [data-radix-hover-card-content] {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3; /* Visual debugging: make them dimmed */
}

/* Alternative fallback using sibling selector */
.dialog-backdrop ~ * .animated-sidebar-trigger,
.dialog-backdrop ~ * .calendar-legend-trigger,
.dialog-backdrop ~ * [data-radix-hover-card-content] {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3;
}

/* Direct override approach - check for dialog backdrop in document */
body:has(.dialog-backdrop) .animated-sidebar-trigger,
body:has(.dialog-backdrop) .calendar-legend-trigger {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3;
}

body:has(.dialog-backdrop) [data-radix-hover-card-content] {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3;
  pointer-events: none;
}

/* JavaScript-based fallback using body class */
body.has-dialog-backdrop .animated-sidebar-trigger,
body.has-dialog-backdrop .calendar-legend-trigger {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3;
}

body.has-dialog-backdrop [data-radix-hover-card-content] {
  z-index: var(--z-elements-below-dialog);
  opacity: 0.3;
  pointer-events: none;
}

/* ========================================
 * RADIX POPOVER OVERRIDES - Critical Fix
 * ======================================== */

/* Override default Radix Popover z-50 when inside dialog context */
[data-radix-popover-content].z-50 {
  z-index: var(--z-dialog-overlays);
}

/* Force all popover content above dialog when dialog is present */
body:has([data-radix-dialog-content]) [data-radix-popover-content] {
  z-index: var(--z-dialog-overlays);
}

/* Command component inside popover should inherit proper z-index */
[data-radix-popover-content] [cmdk-root],
[data-radix-popover-content] [cmdk-list],
[data-radix-popover-content] [cmdk-group],
[data-radix-popover-content] [cmdk-item] {
  position: relative;
  z-index: inherit;
}

/* Dropdown menus should appear above popovers */
/* Since dropdowns are portaled, we target them when popover exists */
/* This ensures dropdowns inside popovers (like language selector) appear correctly */
/* Using high specificity to override inline styles from the component */
body:has([data-radix-popover-content]) [data-radix-dropdown-menu-content] {
  z-index: var(--z-submenu);
}

/* ========================================
 * COMMAND COMPONENT GRID EDITOR OVERRIDES - Critical Fix
 * ======================================== */

/* Force popovers containing Command components above grid editors */
[data-radix-popover-content]:has([cmdk-root]) {
  z-index: var(--z-command-overlay);
}

/* Fallback approaches for better browser compatibility */

/* Target popovers during grid editing sessions */
body:has(.gdg-d19meir1) :where([data-radix-popover-content]),
body:has(.glide-data-grid-overlay-editor) :where([data-radix-popover-content]),
body:has(.click-outside-ignore) :where([data-radix-popover-content]) {
  z-index: var(--z-command-overlay);
}

/* Force any popover that contains a Command component to use command overlay level */
[data-radix-popover-content]:has([cmdk-item]) {
  z-index: var(--z-command-overlay);
}

/* Direct Command component targeting */
.gdg-d19meir1 [cmdk-root],
.glide-data-grid-overlay-editor [cmdk-root],
.click-outside-ignore [cmdk-root] {
  z-index: var(--z-command-overlay);
}

/* CRITICAL FIX: Reset z-index for Command components inside dropdown menus to stay within their container */
[data-radix-dropdown-menu-content] [cmdk-root],
[data-radix-dropdown-menu-content] [cmdk-list],
[data-radix-dropdown-menu-content] [cmdk-group],
[data-radix-dropdown-menu-content] [cmdk-item],
[data-radix-dropdown-menu-content] [data-radix-popover-content]:has([cmdk-root]) {
  z-index: auto;
  position: relative;
}

/* Force positioned elements to use dialog overlay z-index - REMOVED as too broad */

/* ========================================
 * NUCLEAR OVERRIDES - Force proper layering
 * ======================================== */

/* Ensure dialog content is visible with proper z-index */
[data-radix-dialog-content] {
  z-index: var(--z-dialog-content);
}

/* Also apply to any element with dialog-content class */
.dialog-content[data-radix-dialog-content] {
  z-index: var(--z-dialog-content);
}

/* Specific elements that must appear ABOVE dialog */
.gdg-d19meir1,
.glide-data-grid-overlay-editor,
.tempus-dominus-widget,
select,
[data-radix-select-content],
[data-radix-dropdown-menu-content],
.column-menu,
.enhanced-column-menu,
.gdg-dropdown,
.dropdown-menu {
  z-index: var(--z-dialog-overlays);
}
